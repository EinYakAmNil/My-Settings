#!/bin/sh
# Similar to Luke Smith's emoji selector.

table="/home/linkai/.local/share/pinyin.table"
font="Ubuntu Mono:style=Regular:size=16"
prompt="Text thus far: "

# Log levels will determine whether or not the table changes.
# 0: Don't change anything.
# 1: Last typed character will show up on top now.
log_lvl="1"

while true
do
	chosen=$(cat $table | dmenu -i -l 6 -fn "$font" -p "$prompt" | sed "s/:.*//")

#	Exit if none chosen.
	[ -z "$chosen" ] && exit 0
	[ $log_lvl -eq 1 ] && grep ^$chosen":" $table > tmp && sed "/^$chosen":"/d" $table >> tmp && mv tmp $table

# Display currently typed text.
# If you run this command with an argument, it will automatically insert the
# character. Otherwise, copy the characters so far to the clipboard.
	prompt+="$chosen"
	if [ -n "$1" ]
	then
		echo $prompt | sed "s/^.*:\s//" | tr -d '\n' | xclip -selection clipboard
	else
		xdotool type "$chosen"
	fi
done
